/* ============================================
   Daily Theme Variations
   ============================================ */

/*
 * !important LAYERING STRATEGY
 * This file uses !important intentionally for modal override layers.
 * Priority order (highest → lowest):
 *   1. prefers-reduced-motion (accessibility — must always win)
 *   2. E-ink mode (device emulation — overrides all visual effects)
 *   3. Blog editorial integrity (content images must not be filtered)
 *   4. Theme variations (daily themes, mood, intensity)
 *   5. Base styles
 *
 * !important is used in layers 1-3 because their selectors would
 * otherwise lose specificity battles against layer 4's attribute
 * selectors (e.g. [data-image-style][data-card-style] combinations).
 */

/* ============================================
   Mood Modification System
   Real-time theme adjustments based on user mood
   ============================================ */

:root {
  /* Mood modification variables - defaults to neutral */
  --mood-saturation: 1;
  --mood-contrast: 1;
  --mood-brightness: 1;
  --mood-hue-rotate: 0deg;
  --mood-transition-speed: 0.4s;
}

/* Mood: Focus - reduced visual noise, high clarity */
[data-mood="focus"] {
  --mood-saturation: 0.8;
  --mood-contrast: 1.1;
  --mood-brightness: 1.02;
  --mood-transition-speed: 0.6s;
}

/* Mood: Creative - vibrant and experimental */
[data-mood="creative"] {
  --mood-saturation: 1.15;
  --mood-contrast: 1.05;
  --mood-brightness: 1;
  --mood-hue-rotate: 5deg;
  --mood-transition-speed: 0.3s;
}

/* Mood: Relaxed - warm and gentle */
[data-mood="relaxed"] {
  --mood-saturation: 0.95;
  --mood-contrast: 0.92;
  --mood-brightness: 1.02;
  --mood-hue-rotate: 10deg;
  --mood-transition-speed: 0.8s;
}

/* ============================================
   Intensity Modification System
   Adjustable theme drama from subtle to bold
   ============================================ */

:root {
  --intensity: 50;
  --intensity-saturation: 1;
  --intensity-contrast: 1;
  --intensity-type-scale: 1;
  --intensity-shadow-scale: 1;
}

/* Apply combined mood + intensity filters to content wrapper
   NOTE: Cannot apply filter to body because it breaks position: fixed
   for child elements (filter creates a new containing block).
   Apply to .content-filter-wrapper instead. */
.content-filter-wrapper {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  min-height: 100dvh;
  width: 100%;
  filter:
    saturate(calc(var(--mood-saturation) * var(--intensity-saturation)))
    contrast(calc(var(--mood-contrast) * var(--intensity-contrast)))
    brightness(var(--mood-brightness))
    hue-rotate(var(--mood-hue-rotate));
  transition: filter calc(var(--mood-transition-speed) * 2) var(--ease-inertia);
}

/* Focus mood: reduce animation/motion */
[data-mood="focus"] * {
  animation-duration: 2s !important;
}

/* Creative mood: enhance interactive elements */
[data-mood="creative"] a:hover,
[data-mood="creative"] button:hover {
  transform: scale(1.03);
}

/* Relaxed mood: softer shadows */
[data-mood="relaxed"] {
  --card-shadow: 0 4px 20px rgba(0,0,0,0.06);
  --shadow-hover: 0 8px 30px rgba(0,0,0,0.1);
}

/* E-ink mode overrides mood/intensity */
[data-e-ink="true"] .content-filter-wrapper {
  filter: none !important;
}

/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  .content-filter-wrapper {
    filter: none !important;
    transition: none !important;
  }
}

/* ============================================
   E-Ink Mode
   High contrast, grayscale, no effects
   Mimics e-reader displays (Kindle, reMarkable)
   ============================================ */

[data-e-ink="true"] {
  /* High contrast colors - cream background like real e-ink */
  --color-text: #000000;
  --color-bg: #f5f5f0;
  --color-link: #000000;
  --color-link-hover: #444444;
  --color-border: #000000;
  --color-muted: #555555;
  --color-sidebar-bg: #e8e8e3;
  --color-nav-bg: #e8e8e3;
  --color-nav-text: #000000;
  --color-nav-hover: rgba(0, 0, 0, 0.1);
  --color-card-bg: #e8e8e3;

  /* Remove all shadows and effects */
  --card-shadow: none;
  --shadow-default: none;
  --shadow-hover: none;
  --shadow-scrolling: none;
  --inner-border: none;
  --inner-border-button: none;

}

html[data-e-ink="true"] {
  background-color: #f5f5f0;
}

/* E-Ink dark mode */
[data-e-ink="true"][data-theme="dark"] {
  --color-text: #e0e0e0;
  --color-bg: #121212;
  --color-link: #e0e0e0;
  --color-link-hover: #ffffff;
  --color-border: #e0e0e0;
  --color-muted: #aaaaaa;
  --color-sidebar-bg: #1a1a1a;
  --color-nav-bg: #1a1a1a;
  --color-nav-text: #e0e0e0;
  --color-nav-hover: rgba(255, 255, 255, 0.1);
  --color-card-bg: #1a1a1a;

}

html[data-e-ink="true"][data-theme="dark"] {
  background-color: #121212;
}

/* Force grayscale on all images in e-ink mode */
[data-e-ink="true"] img {
  filter: grayscale(1) contrast(1.1) !important;
}

/* Disable all transitions and animations in e-ink mode */
[data-e-ink="true"] *,
[data-e-ink="true"] *::before,
[data-e-ink="true"] *::after {
  transition: none !important;
  animation: none !important;
}

/* Remove glass/blur effects in e-ink mode */
[data-e-ink="true"] .card-glass,
[data-e-ink="true"] .surface-glass {
  background: var(--color-sidebar-bg) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  border: 1px solid var(--color-border);
}

/* Simple underline links in e-ink mode */
[data-e-ink="true"] a {
  text-decoration: underline;
  text-underline-offset: 2px;
  border-bottom: none;
}

[data-e-ink="true"] a::after {
  display: none !important;
}

/* Hide shader background in e-ink mode */
[data-e-ink="true"] .shader-background {
  display: none !important;
}

/* Remove background textures in e-ink mode */
[data-e-ink="true"]::before {
  display: none !important;
}

/* Simplify hero title in e-ink mode */
[data-e-ink="true"] .hero-title {
  background-image: none;
  background-color: var(--color-sidebar-bg);
}

/* Remove hover transforms in e-ink mode */
[data-e-ink="true"] .card-interactive:hover,
[data-e-ink="true"] .btn:hover,
[data-e-ink="true"] a:hover {
  transform: none !important;
}

/* E-Ink: Card Stack Hero - monochromatic cards */
[data-e-ink="true"] .card-stack-hero .card {
  background-color: #3a3a3a !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), inset 0 0 0 1px rgba(255, 255, 255, 0.1) !important;
}

[data-e-ink="true"][data-theme="dark"] .card-stack-hero .card {
  background-color: #2a2a2a !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5), inset 0 0 0 1px rgba(255, 255, 255, 0.05) !important;
}

/* E-Ink: Card thumbnails and images - high contrast grayscale */
[data-e-ink="true"] .card-stack-hero .card-thumbnail,
[data-e-ink="true"] .card-stack-hero .card-image {
  filter: grayscale(1) contrast(1.3) !important;
}

/* E-Ink: Hide colorful patterns, show simple lines */
[data-e-ink="true"] .card-stack-hero .card-pattern svg {
  opacity: 0.2 !important;
}

[data-e-ink="true"] .card-stack-hero .card-pattern svg * {
  stroke: rgba(255, 255, 255, 0.5) !important;
  fill: rgba(255, 255, 255, 0.3) !important;
}

/* E-Ink: Hero portrait/images on other pages */
[data-e-ink="true"] .hero-portrait,
[data-e-ink="true"] .hero-image-bg,
[data-e-ink="true"] .node-card-image {
  filter: grayscale(1) contrast(1.2) !important;
}

/* E-Ink: All background images */
[data-e-ink="true"] [style*="background-image"] {
  filter: grayscale(1) contrast(1.2) !important;
}

/* E-Ink: Navigation bar - explicit background, no effects */
[data-e-ink="true"] nav {
  background: #e8e8e3 !important;
  border-color: #000000 !important;
  box-shadow: none !important;
}

[data-e-ink="true"][data-theme="dark"] nav {
  background: #1a1a1a !important;
  border-color: #e0e0e0 !important;
}

[data-e-ink="true"] nav .noise-canvas,
[data-e-ink="true"] nav .particle-canvas {
  display: none !important;
}

[data-e-ink="true"] nav::after {
  display: none !important;
}

/* ============================================
   Daily Theme: Grid Style Variations
   Applied via [data-grid-style] attribute
   ============================================ */

/* Asymmetric grid - unbalanced columns for visual tension */
[data-grid-style="asymmetric"] .container {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: var(--section-spacing, 2rem);
}

@media (max-width: 768px) {
  [data-grid-style="asymmetric"] .container {
    grid-template-columns: 1fr;
  }
}

/* Split-screen - two distinct halves */
[data-grid-style="split"] .container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0;
}

[data-grid-style="split"] .container > *:nth-child(odd) {
  padding-right: var(--content-padding, 2rem);
}

[data-grid-style="split"] .container > *:nth-child(even) {
  padding-left: var(--content-padding, 2rem);
  border-left: 1px solid var(--color-border);
}

@media (max-width: 768px) {
  [data-grid-style="split"] .container {
    grid-template-columns: 1fr;
  }

  [data-grid-style="split"] .container > *:nth-child(odd) {
    padding-right: 0;
  }

  [data-grid-style="split"] .container > *:nth-child(even) {
    padding-left: 0;
    border-left: none;
    border-top: 1px solid var(--color-border);
    padding-top: var(--content-padding, 2rem);
  }
}

/* Magazine layout - multi-column flowing text */
[data-grid-style="magazine"] .container {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: var(--section-spacing, 2rem);
}

[data-grid-style="magazine"] .container > *:first-child {
  grid-column: 1 / -1;
}

@media (max-width: 1024px) {
  [data-grid-style="magazine"] .container {
    grid-template-columns: 1fr 1fr;
  }
}

@media (max-width: 768px) {
  [data-grid-style="magazine"] .container {
    grid-template-columns: 1fr;
  }
}

/* Sidebar layout - persistent side panel */
[data-grid-style="sidebar"] .container {
  display: grid;
  grid-template-columns: 280px 1fr;
  gap: var(--section-spacing, 2rem);
}

[data-grid-style="sidebar"] .container > *:first-child {
  position: sticky;
  top: var(--content-top-padding);
  align-self: start;
}

@media (max-width: 768px) {
  [data-grid-style="sidebar"] .container {
    grid-template-columns: 1fr;
  }

  [data-grid-style="sidebar"] .container > *:first-child {
    position: static;
  }
}

/* ============================================
   Daily Theme: Font Variation Settings
   Applied via --font-variation-settings custom property
   ============================================ */

:root {
  --font-variation-settings: normal;
}

[data-daily-theme] h1,
[data-daily-theme] h2,
[data-daily-theme] h3,
[data-daily-theme] h4,
[data-daily-theme] h5,
[data-daily-theme] h6 {
  font-variation-settings: var(--font-variation-settings);
}

/* ============================================
   Daily Theme: Extreme Typography Scale
   Applied via --scale-ratio custom property
   ============================================ */

:root {
  --scale-ratio: 1.333;
  --text-micro: calc(1rem / var(--scale-ratio) / var(--scale-ratio));
  --text-sm: calc(1rem / var(--scale-ratio));
  --text-base: 1rem;
  --text-lg: calc(1rem * var(--scale-ratio));
  --text-xl: calc(1rem * var(--scale-ratio) * var(--scale-ratio));
  --text-2xl: calc(1rem * var(--scale-ratio) * var(--scale-ratio) * var(--scale-ratio));
  --text-jumbo: calc(1rem * var(--scale-ratio) * var(--scale-ratio) * var(--scale-ratio) * var(--scale-ratio));
  --text-display-xl: calc(1rem * var(--scale-ratio) * var(--scale-ratio) * var(--scale-ratio) * var(--scale-ratio) * var(--scale-ratio));
}

/* Apply scale-driven sizes when daily theme is active */
[data-daily-theme] .text-micro {
  font-size: var(--text-micro);
  line-height: 1.4;
  letter-spacing: 0.01em;
}

[data-daily-theme] .text-jumbo {
  font-size: var(--text-jumbo);
  line-height: 0.95;
  letter-spacing: -0.03em;
}

[data-daily-theme] .text-display-xl {
  font-size: var(--text-display-xl);
  line-height: 0.9;
  letter-spacing: -0.04em;
}

/* ============================================
   Daily Theme: Contrast Mode Variations
   Applied via [data-contrast-mode] attribute
   ============================================ */

[data-contrast-mode="high"] {
  --intensity-contrast: 1.2;
}

[data-contrast-mode="low"] {
  --intensity-contrast: 0.85;
}

/* ============================================
   Daily Theme: Navigation Style Variations
   ============================================ */

/* Full-width navigation */
[data-nav-style="full-width"] nav {
  width: 100%;
  max-width: 100%;
  left: 0;
  right: 0;
  margin: 0;
  border-radius: 0;
  padding: var(--nav-padding);
}

/* Minimal navigation */
[data-nav-style="minimal"] nav {
  background: transparent;
  border: none;
  box-shadow: none;
  backdrop-filter: none;
}

/* Bold bar navigation */
[data-nav-style="bold-bar"] nav {
  background: var(--color-nav-bg);
  min-height: var(--nav-height, 60px);
  padding: var(--nav-padding);
  border-width: 0 0 3px 0;
  border-radius: 0;
}

/* ============================================
   Daily Theme: Card Style Variations
   ============================================ */

/* Flat cards - no shadow, border only */
[data-card-style="flat"] .card,
[data-card-style="flat"] .node-card {
  box-shadow: none;
  border: var(--card-border-width, 1px) solid var(--color-border);
}

/* Outlined cards - strong border, no shadow */
[data-card-style="outlined"] .card,
[data-card-style="outlined"] .node-card {
  box-shadow: none;
  border: var(--card-border-width, 2px) solid var(--color-text);
}

/* Glass cards - blur + transparency */
[data-card-style="glass"] .card,
[data-card-style="glass"] .node-card {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  /* GPU acceleration for blur performance */
  transform: translateZ(0);
}

/* Reduce glass blur on mobile for better performance */
@media (max-width: 768px) {
  [data-card-style="glass"] .card,
  [data-card-style="glass"] .node-card {
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }
}

[data-theme="dark"][data-card-style="glass"] .card,
[data-theme="dark"][data-card-style="glass"] .node-card {
  background: rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Elevated cards - shadows */
[data-card-style="elevated"] .card,
[data-card-style="elevated"] .node-card {
  box-shadow: var(--card-shadow, 0 4px 16px rgba(0,0,0,0.1));
  border: none;
}

/* Filled cards - solid background */
[data-card-style="filled"] .card,
[data-card-style="filled"] .node-card {
  background: var(--color-card-bg, var(--color-sidebar-bg));
  border: none;
  box-shadow: none;
}

/* ============================================
   Daily Theme: Hero Layout Variations
   Layouts are rendered by React sub-components in
   src/components/hero/layouts/. These CSS rules provide
   overflow and sizing adjustments for non-default layouts.
   ============================================ */

/* Layouts that break out of the container need visible overflow */
[data-hero-layout="editorial"] .card-stack-section,
[data-hero-layout="scattered"] .card-stack-section,
[data-hero-layout="rolodex"] .card-stack-section {
  overflow: visible;
}

/* Legacy value mapping - in case stored themes still use old names */
[data-hero-layout="centered"] .card-stack-section { overflow: hidden; }
[data-hero-layout="left-aligned"] .card-stack-section { overflow: visible; }
[data-hero-layout="minimal"] .card-stack-section { overflow: visible; }
[data-hero-layout="bold"] .card-stack-section { overflow: visible; }

/* ============================================
   Daily Theme: Link Style Variations
   ============================================ */

/* Underline (default) */
[data-link-style="underline"] a:not(.nav-link):not(.footer-link) {
  text-decoration: underline;
  text-underline-offset: 3px;
}

/* Highlight - background highlight on hover */
[data-link-style="highlight"] a:not(.nav-link):not(.footer-link) {
  text-decoration: none;
  transition: background-color 0.2s ease;
}

[data-link-style="highlight"] a:not(.nav-link):not(.footer-link):hover {
  background-color: var(--color-link);
  color: var(--color-bg);
  padding: 0.1em 0.2em;
  margin: -0.1em -0.2em;
  border-radius: 2px;
}

/* Animated underline - grows on hover */
[data-link-style="animated-underline"] a:not(.nav-link):not(.footer-link) {
  text-decoration: none;
  position: relative;
}

[data-link-style="animated-underline"] a:not(.nav-link):not(.footer-link)::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 0;
  height: 2px;
  background: var(--color-link);
  transition: width 0.3s ease;
}

[data-link-style="animated-underline"] a:not(.nav-link):not(.footer-link):hover::after {
  width: 100%;
}

/* Color only - no underline */
[data-link-style="color-only"] a:not(.nav-link):not(.footer-link) {
  text-decoration: none;
  transition: opacity 0.3s var(--ease-inertia);
}

[data-link-style="color-only"] a:not(.nav-link):not(.footer-link):hover {
  opacity: 0.8;
}

/* Bracket - decorative brackets on hover */
[data-link-style="bracket"] a:not(.nav-link):not(.footer-link) {
  text-decoration: none;
  position: relative;
}

[data-link-style="bracket"] a:not(.nav-link):not(.footer-link)::before,
[data-link-style="bracket"] a:not(.nav-link):not(.footer-link)::after {
  opacity: 0;
  transition: opacity 0.2s ease, transform 0.2s ease;
}

[data-link-style="bracket"] a:not(.nav-link):not(.footer-link)::before {
  content: '[';
  transform: translateX(5px);
}

[data-link-style="bracket"] a:not(.nav-link):not(.footer-link)::after {
  content: ']';
  transform: translateX(-5px);
}

[data-link-style="bracket"] a:not(.nav-link):not(.footer-link):hover::before,
[data-link-style="bracket"] a:not(.nav-link):not(.footer-link):hover::after {
  opacity: 1;
  transform: translateX(0);
}

/* ============================================
   Daily Theme: Background Texture Variations
   ============================================ */

/* Grain texture - film grain effect */
[data-bg-texture="grain"]::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0.03;
  pointer-events: none;
  z-index: var(--z-texture);
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)'/%3E%3C/svg%3E");
}

/* Dots texture - polka dot pattern */
[data-bg-texture="dots"]::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0.03;
  pointer-events: none;
  z-index: var(--z-texture);
  background-image: radial-gradient(circle, currentColor 1px, transparent 1px);
  background-size: 20px 20px;
}

/* Grid texture - faint grid lines */
[data-bg-texture="grid"]::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0.04;
  pointer-events: none;
  z-index: var(--z-texture);
  background-image:
    linear-gradient(to right, currentColor 1px, transparent 1px),
    linear-gradient(to bottom, currentColor 1px, transparent 1px);
  background-size: 40px 40px;
}

/* Gradient texture - subtle gradient overlay */
[data-bg-texture="gradient"]::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0.5;
  pointer-events: none;
  z-index: -1;
  background: radial-gradient(ellipse at top, var(--color-sidebar-bg) 0%, transparent 70%);
}

/* ============================================
   Daily Theme: Image Treatment Variations
   ============================================ */

/* Default theme: Paper texture effect for hero image */
html:not([data-image-style]) .hero-portrait {
  filter: sepia(0.12) saturate(0.85) contrast(0.95) brightness(1.02);
  transition: filter 0.4s ease;
}

/* Base image styles */
[data-daily-theme] img:not(.avatar):not(.icon) {
  opacity: var(--image-opacity, 1);
  border-radius: var(--image-border-radius, var(--radius-md));
  /* Specific transitions for better performance - avoid `all` */
  transition:
    opacity 0.4s ease,
    filter 0.4s ease,
    transform 0.4s ease;
}

/* Vivid - full color, punchy */
[data-image-style="vivid"] .portrait-container img,
[data-image-style="vivid"] .hero-image-container .hero-image-bg {
  filter: saturate(1.25) contrast(1.1) brightness(1.02);
}

/* Muted - desaturated, softer */
[data-image-style="muted"] .portrait-container img,
[data-image-style="muted"] .hero-image-container .hero-image-bg {
  filter: saturate(0.6) contrast(0.9) brightness(1.05);
}

/* Grayscale - black and white */
[data-image-style="grayscale"] .portrait-container img,
[data-image-style="grayscale"] .hero-image-container .hero-image-bg {
  filter: grayscale(1);
}

/* Duotone - tinted sepia effect */
[data-image-style="duotone"] .portrait-container img,
[data-image-style="duotone"] .hero-image-container .hero-image-bg {
  filter: grayscale(1) sepia(0.4) saturate(1.2);
}

/* Warm - warm golden tones */
[data-image-style="warm"] .portrait-container img,
[data-image-style="warm"] .hero-image-container .hero-image-bg {
  filter: sepia(0.15) saturate(1.1) brightness(1.02);
}

/* Cool - cooler blue tones */
[data-image-style="cool"] .portrait-container img,
[data-image-style="cool"] .hero-image-container .hero-image-bg {
  filter: saturate(0.9) brightness(1.05) hue-rotate(-10deg);
}

/* High contrast - dramatic */
[data-image-style="contrast"] .portrait-container img,
[data-image-style="contrast"] .hero-image-container .hero-image-bg {
  filter: contrast(1.3) saturate(1.1);
}

/* Image hover effects */

/* Zoom - scale up */
[data-image-hover="zoom"] .portrait-container img:hover {
  transform: scale(1.05);
}

/* Lift - shadow + translate */
[data-image-hover="lift"] .portrait-container img:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}

/* Colorize - grayscale to color */
[data-image-hover="colorize"] .portrait-container img {
  filter: grayscale(1);
}

[data-image-hover="colorize"] .portrait-container img:hover {
  filter: grayscale(0);
}

/* Glow - subtle glow effect */
[data-image-hover="glow"] .portrait-container img:hover {
  box-shadow: 0 0 30px var(--color-link);
}

/* Exclude writing/blog images from theme filters
   Blog posts should display images as-is for editorial integrity */
.blog-post img,
.blog-post .prose-content img,
.prose-content img,
article.blog-post img {
  filter: none !important;
  mix-blend-mode: normal !important;
  transform: none;
  box-shadow: none;
}

.blog-post img:hover,
.blog-post .prose-content img:hover,
.prose-content img:hover,
article.blog-post img:hover {
  filter: none !important;
  transform: none !important;
  box-shadow: none !important;
}

/* ============================================
   Heavy Shader: Content Area Solid Backgrounds
   For themes with complex shaders (waves, mesh, swirl, etc.)
   content areas get semi-opaque backgrounds for readability
   ============================================ */

[data-shader="waves"] main,
[data-shader="mesh-gradient"] main,
[data-shader="swirl"] main,
[data-shader="perlin"] main,
[data-shader="simplex"] main,
[data-shader="neuro"] main {
  position: relative;
}

[data-shader="waves"] .container,
[data-shader="mesh-gradient"] .container,
[data-shader="swirl"] .container,
[data-shader="perlin"] .container,
[data-shader="simplex"] .container,
[data-shader="neuro"] .container {
  background: var(--color-bg);
  /* Preserve nav clearance on top, use 2rem for other sides */
  padding-top: var(--content-top-padding);
  padding-left: 2rem;
  padding-right: 2rem;
  padding-bottom: 2rem;
  border-radius: var(--radius-lg, 12px);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
  /* CRITICAL: Never add top margin that would clip the layout */
  margin-top: 0;
}

/* Remove container background on home page with card stack */
[data-shader] .container:has(.card-stack-section) {
  background: transparent;
  box-shadow: none;
  border-radius: 0;
  /* Preserve top padding for nav clearance */
  padding-left: 0;
  padding-right: 0;
  padding-bottom: 0;
}

/* Reduced opacity for content cards with heavy shaders */
[data-shader="waves"] .portfolio-content,
[data-shader="mesh-gradient"] .portfolio-content,
[data-shader="swirl"] .portfolio-content,
[data-shader="perlin"] .portfolio-content,
[data-shader="simplex"] .portfolio-content,
[data-shader="neuro"] .portfolio-content {
  background: var(--color-card-bg);
  padding: 1.5rem;
  border-radius: var(--radius-md, 8px);
}

/* Philosophy items need backgrounds too */
[data-shader="waves"] .philosophy-item,
[data-shader="mesh-gradient"] .philosophy-item,
[data-shader="swirl"] .philosophy-item,
[data-shader="perlin"] .philosophy-item,
[data-shader="simplex"] .philosophy-item,
[data-shader="neuro"] .philosophy-item {
  background: var(--color-card-bg);
  padding: 1.5rem;
  border-radius: var(--radius-md, 8px);
}

/* Newsletter signup needs consistent background on shader pages */
[data-shader] .substack-signup {
  background: var(--color-card-bg, var(--color-sidebar-bg));
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}