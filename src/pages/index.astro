---
import MainLayout from '../layouts/MainLayout.astro';
import SubstackSignup from '../components/SubstackSignup.astro';
import { getCollection } from 'astro:content';
import imgDhWebLight from '../assets/images/img-dh-web-light.jpg';
import imgDhWebDark from '../assets/images/img-dh-web-dark.jpg';
import imgDhWebLightFluted from '../assets/images/img-dh-web-light-fluted-glass.jpg';
import imgHighlightsHatch from '../assets/images/highlights/img-highlights-hatch-conference.jpg';
import imgHighlightsReplit from '../assets/images/highlights/img-highlights-replit.jpg';
import imgHighlightsPlay from '../assets/images/highlights/img-highlights-play.jpg';
import imgHighlightsPoc from '../assets/images/highlights/img-highlights-proof-of-concept.jpg';
import imgLinen from '../assets/images/bg-linen.jpeg';

// Page metadata
const pageDescription = "David Hoang is a designer, investor, and builder focused on tools that revolutionize the internet. VP and Head of Design, AI at Atlassian. Previously at Replit, Webflow, and One Medical.";
const ogImage = "/images/img-dh-web-light.jpg";
---

<MainLayout title="David Hoang" description={pageDescription} ogImage={ogImage}>
  <!-- Hero Section -->
  <section class="hero-grid" aria-labelledby="hero-heading">
    <div class="hero-content">
      <h1 id="hero-heading">David Hoang is a Designer and Investor.</h1>
      <ul role="list" aria-label="Quick links and highlights">
        <li>Subscribe to my newsletter, <a href="https://www.proofofconcept.pub" target="_blank" rel="noopener noreferrer">Proof of Concept</a></li>
        <li>Buy the zine, <a href="https://davidhoang.gumroad.com/l/proof-of-concept-000-series" rel="noopener noreferrer">Proof of Concept: The 000 Series</a></li>
        <li><a href="https://github.com/davidhoang" rel="noopener noreferrer">Follow me on GitHub</a></li>
        <li><a href="https://youtu.be/piGC-iFwmrk?si=RuQtmVtimws3npVM" rel="noopener noreferrer">Watch my talk from Config 2021</a></li>
        <li><a href="https://www.youtube.com/watch?v=6Z88rLjF-lc" rel="noopener noreferrer">Listen to my interview on Dive Club</a></li>
        <li>A few recommended pieces: <a href="https://www.davidhoang.com/writing/career-reboot" target="_blank" rel="noopener noreferrer">Career Reboot</a>, <a href="https://www.davidhoang.com/writing/design-engineering" target="_blank" rel="noopener noreferrer">Design Engineering</a>, and <a href="https://www.davidhoang.com/writing/the-four-types-of-software-in-the-future" target="_blank" rel="noopener noreferrer">The four types of software in the future</a></li>
        <li><a href="/career-odyssey" rel="noopener noreferrer">Explore my Career Odyssey</a> — an interactive canvas of my career journey</li>
      </ul>
    </div>
    <div class="hero-image">
      <div class="hero-image-wrapper">
        <div class="linen-background" style={`background-image: url(${imgLinen.src})`}></div>
        <picture>
          <source srcset={imgDhWebDark.src} media="(prefers-color-scheme: dark)">
          <img src={imgDhWebLight.src} alt="Professional headshot photo of David Hoang" width="400" height="533" fetchpriority="high" decoding="async" class="hero-image-base" />
        </picture>
        <img src={imgDhWebLightFluted.src} alt="" class="hero-image-fluted" width="400" height="533" decoding="async" aria-hidden="true" />
      </div>
    </div>
  </section>
  <section class="design-philosophy" aria-labelledby="philosophy-heading">
    <h2 id="philosophy-heading">Design philosophy</h2>
    <div class="philosophy-grid" role="list" aria-label="Design philosophy principles">
      <div class="philosophy-item" role="listitem">
        <p><strong>Seek paradigm shifts.</strong> Imagine the future and build it now. Those who can spot trends of shifts will have enduring success.</p>
      </div>
      <div class="philosophy-item" role="listitem" id="e3d275">
        <p><strong>Embrace the entrepreneurial spirit.</strong> Act like the owner of everything you do.</p>
      </div>
      <div class="philosophy-item" role="listitem">
        <p><strong>Software is beautiful.</strong> Making high quality software is a calling and privilege to do so.</p>
      </div>
      <div class="philosophy-item" role="listitem" id="647f3a">
        <p><strong>Method makes magic.</strong> Design is not magic. It's a method—a rigorous process of exploration, iteration, and validation until you reach a result that feels magical.</p>
      </div>
      
      <div class="philosophy-item" role="listitem">
        <p><strong>Iteration over perfectionism.</strong> The number one way to be more productive is to reduce the iteration cycle.</p>
      </div>
    </div>
  </section>
  <!-- Portfolio Section -->
  <section class="portfolio-section" aria-labelledby="highlights-heading">
    <h2 id="highlights-heading">Highlights</h2>
    <p>A few recent moments and projects. For full work history, see <a href="http://linkedin.com/in/dhoang2" target="_blank" rel="noopener noreferrer">LinkedIn</a>.</p>
    <div class="portfolio-grid" role="list" aria-label="Recent highlights and projects">
      <div class="portfolio-content" role="listitem">
        <div class="portfolio-item-text">
          <h3>September 2024</h3>
          <p><a href="https://www.youtube.com/watch?v=4lWYcr53kyI" target="_blank" rel="noopener noreferrer">Keynote talk at Hatch Conference: Design & (Blank)</a></p>
        </div>
        <div class="portfolio-images">
          <img src={imgHighlightsHatch.src} alt="David Hoang speaking at Hatch Conference 2024, presenting on stage" loading="lazy" decoding="async" width="1200" height="800">
        </div>
      </div>
      <div class="portfolio-content" role="listitem">
        <div class="portfolio-item-text">
          <h3>April 2024</h3>
          <p><a href="https://www.youtube.com/watch?v=T6R9nx89bY4" target="_blank" rel="noopener noreferrer">Replit Developer Day</a> and rebrand.</p>
        </div>
        <div class="portfolio-images">
          <img src={imgHighlightsReplit.src} alt="Replit Developer Day 2024 event branding and visual identity" loading="lazy" decoding="async" width="1200" height="800">
        </div>
      </div>
      <div class="portfolio-content" role="listitem">
        <div class="portfolio-item-text">
          <h3>April 2023</h3>
          <p>Joined <a href="https://createwithplay.com" target="_blank" rel="noopener noreferrer">Play</a> as Advisor.</p>
        </div>
        <div class="portfolio-images">
          <img src={imgHighlightsPlay.src} alt="Play app interface and branding design" loading="lazy" decoding="async" width="1200" height="800">
        </div>
      </div>
      <div class="portfolio-content" role="listitem">
        <div class="portfolio-item-text">
          <h3>December 2019</h3>
          <p>Launched <a href="https://www.proofofconcept.pub" target="_blank" rel="noopener noreferrer">Proof of Concept</a>, a newsletter about design, technology, and entrepreneurship.</p>
        </div>
        <div class="portfolio-images">
          <img src={imgHighlightsPoc.src} alt="Proof of Concept newsletter branding and design layout" loading="lazy" decoding="async" width="1200" height="800">
        </div>
      </div>
      
    </div>
  </section>

  <!-- Newsletter Signup Section -->
  <section class="newsletter-section" aria-labelledby="newsletter-heading">
    <SubstackSignup />
  </section>

  <style>
    /* Hero Section */
    .hero-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
      width: 100%;
      margin-top: 96px;
      padding: 48px 0;
    }

    .hero-content a {
      color: var(--color-link);
      text-decoration: none;
      border-bottom: 1px dotted var(--color-link);
      transition: all 0.3s ease;
    }

    .hero-content a:hover {
      color: var(--color-link-hover);
      border-bottom-color: var(--color-link-hover);
    }

    .hero-content ul {
      margin: 0px 0px 0px 24px;
    }

    .hero-image-wrapper {
      position: relative;
      display: inline-block;
      border-radius: 8px;
      overflow: hidden;
    }

    .linen-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0;
      transform: translateY(-100%);
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 0;
      border-radius: 8px;
    }

    .hero-image-base,
    .hero-image-fluted {
      display: block;
      width: 400px;
      height: auto;
      border-radius: 8px;
      transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
      position: relative;
      z-index: 1;
      will-change: transform;
    }

    .hero-image-fluted {
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0;
      pointer-events: none;
    }

    .hero-image-wrapper:hover .hero-image-base {
      opacity: 0;
      transform: scale(1.05);
    }

    .hero-image-wrapper:hover .hero-image-fluted {
      opacity: 1;
      transform: scale(1.05);
    }

    /* Design Philosophy Section */
    .design-philosophy {
      border-top: 1px solid var(--color-border);
      padding-top: 24px;
    }

    .philosophy-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 2rem;
      padding-right: 24px;
    }

    .philosophy-item {
      border-radius: 8px;
    }

    .philosophy-item h3 {
      margin-top: 0;
      font-size: 1.25rem;
      margin-bottom: 0.75rem;
    }

    /* Portfolio Section */
    .portfolio-section {
      margin: 4rem 0;
      border-top: 1px solid var(--color-border);
      padding-top: 24px;
      content-visibility: auto;
      contain-intrinsic-size: 800px 1000px;
    }

    .portfolio-content {
      margin-bottom: 1.5rem;
      max-width: 800px;
    }

    .portfolio-content h3 {
      margin: 0 0 0.5rem 0;
      font-size: 1.25rem;
    }

    .portfolio-content a {
      font-weight: 500;
      color: var(--color-link);
    }

    .portfolio-images {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      width: 100%;
      overflow: hidden;
    }

    .portfolio-images img {
      flex: 1;
      height: 300px;
      object-fit: cover;
      border-radius: 8px;
      max-width: 75%;
    }

    /* Newsletter Section */
    .newsletter-section {
      display: grid;
      grid-template-columns: 1fr;
      padding: 2rem 5rem;
      text-align: center;
      width: 100%;
    }

    .substack-embed-wrapper {
      background-color: var(--color-bg);
      padding: 1rem;
      border-radius: 8px;
    }

    #substackEmbed {
      background-color: var(--color-bg);
    }

    :global([data-theme="dark"]) #substackEmbed {
      filter: invert(1) hue-rotate(180deg);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .hero-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
        margin: 2rem 0 0 0;
      }

      .hero-content h1 {
        font-size: 2.25rem;
      }

      .philosophy-grid {
        grid-template-columns: 1fr;
      }

      .portfolio-content {
        max-width: 100%;
      }

      .portfolio-images {
        flex-direction: column;
      }

      .portfolio-images img {
        width: 100%;
        max-width: 100%;
      }

      .newsletter-section {
        padding: 2rem 1rem;
      }
    }

    @media (max-width: 480px) {
      .hero-image img,
      .hero-image-base,
      .hero-image-fluted {
        width: 100%;
        height: auto;
      }
    }
  </style>

  <script>
    // Parallax scroll effect with smooth inertia-based animation for hero portrait
    function initParallax() {
      const imageWrapper = document.querySelector('.hero-image-wrapper');
      const imageBase = document.querySelector('.hero-image-base');
      const imageFluted = document.querySelector('.hero-image-fluted');
      const linenBackground = document.querySelector('.linen-background');
      
      if (!imageWrapper || !imageBase) return;

      let currentOffset = 0;
      let targetOffset = 0;
      let currentScale = 1;
      let targetScale = 1;
      let velocity = 0;
      let lastScrollY = window.scrollY;
      let lastTime = performance.now();
      let animationFrameId = null;
      let isScrolling = false;
      let scrollTimeout = null;
      let overscrollAmount = 0;
      let currentOverscroll = 0;
      let touchStartY = 0;
      let isPulling = false;

      // Smooth interpolation with inertia
      function lerp(start, end, factor) {
        return start + (end - start) * factor;
      }

      function calculateParallaxValues() {
        const rect = imageWrapper.getBoundingClientRect();
        const windowHeight = window.innerHeight;
        const containerHeight = rect.height;
        const scrolled = window.scrollY;
        const containerTop = imageWrapper.offsetTop;
        
        // If not actively pulling, reset overscroll
        if (!isPulling) {
          overscrollAmount = Math.max(0, overscrollAmount * 0.92); // Damping
        }
        
        if (rect.bottom >= 0 && rect.top <= windowHeight) {
          const scrollDistance = scrolled - containerTop;
          const parallaxSpeed = 0.3;
          const offset = scrollDistance * parallaxSpeed;
          
          // Calculate scroll progress (0 to 1) within the container viewport
          // Scale from 1 to 1.1 as user scrolls down (more subtle for portrait)
          const scrollProgress = Math.max(0, Math.min(1, 
            (scrollDistance + windowHeight) / (containerHeight + windowHeight)
          ));
          const scale = 1 + (scrollProgress * 0.4); // 1 to 1.4
          
          return { offset, scale };
        } else if (rect.top > windowHeight) {
          return { offset: 0, scale: 1 };
        }
        return { offset: currentOffset, scale: currentScale };
      }

      function animate() {
        const now = performance.now();
        const deltaTime = Math.min((now - lastTime) / 1000, 0.1);
        lastTime = now;

        // Calculate target offset and scale
        const { offset, scale } = calculateParallaxValues();
        targetOffset = offset;
        targetScale = scale;

        // Smooth interpolation with momentum
        const lerpFactor = isScrolling ? 0.15 : 0.08;
        currentOffset = lerp(currentOffset, targetOffset, lerpFactor);
        currentScale = lerp(currentScale, targetScale, lerpFactor);

        // Apply velocity for inertia effect
        if (!isScrolling) {
          const difference = targetOffset - currentOffset;
          velocity = lerp(velocity, difference * 0.5, 0.1);
          currentOffset += velocity;
          
          // Damping
          velocity *= 0.92;
          
          if (Math.abs(targetOffset - currentOffset) < 0.1 && Math.abs(velocity) < 0.1) {
            currentOffset = targetOffset;
            currentScale = targetScale;
            velocity = 0;
          }
        }

        // Smooth overscroll interpolation
        currentOverscroll = lerp(currentOverscroll, overscrollAmount, 0.15);
        
        // Apply transform with both translateY and scale
        const baseTransform = `translateY(${currentOffset}px) scale(${currentScale})`;
        imageBase.style.transform = baseTransform;
        if (imageFluted) {
          imageFluted.style.transform = baseTransform;
        }
        
        // Reveal linen background based on overscroll
        if (linenBackground) {
          const maxOverscroll = 200;
          const overscrollProgress = Math.min(currentOverscroll / maxOverscroll, 1);
          const translateY = -100 + (overscrollProgress * 100);
          
          linenBackground.style.opacity = overscrollProgress;
          linenBackground.style.transform = `translateY(${translateY}%)`;
        }

        // Continue animation if needed
        if (isScrolling || Math.abs(targetOffset - currentOffset) > 0.1 || Math.abs(targetScale - currentScale) > 0.001 || Math.abs(velocity) > 0.1 || currentOverscroll > 0.1) {
          animationFrameId = requestAnimationFrame(animate);
        } else {
          animationFrameId = null;
        }
      }

      function onScroll() {
        const currentScrollY = window.scrollY;
        const scrollDelta = currentScrollY - lastScrollY;
        lastScrollY = currentScrollY;

        isScrolling = true;
        
        if (scrollTimeout) {
          clearTimeout(scrollTimeout);
        }

        if (!animationFrameId) {
          lastTime = performance.now();
          animationFrameId = requestAnimationFrame(animate);
        }

        scrollTimeout = setTimeout(() => {
          isScrolling = false;
          if (!animationFrameId) {
            lastTime = performance.now();
            animationFrameId = requestAnimationFrame(animate);
          }
        }, 50);
      }

      // Touch events for pull-to-reveal
      function onTouchStart(e) {
        if (window.scrollY <= 0 && imageWrapper.getBoundingClientRect().top <= 0) {
          touchStartY = e.touches[0].clientY;
          isPulling = true;
        }
      }

      function onTouchMove(e) {
        if (!isPulling) return;
        
        const currentY = e.touches[0].clientY;
        const deltaY = currentY - touchStartY;
        
        if (deltaY > 0 && window.scrollY <= 0) {
          overscrollAmount = deltaY;
          e.preventDefault();
        } else {
          isPulling = false;
          overscrollAmount = 0;
        }
      }

      function onTouchEnd() {
        isPulling = false;
      }

      // Wheel events for desktop pull-to-reveal
      function onWheel(e) {
        if (window.scrollY <= 0 && imageWrapper.getBoundingClientRect().top <= 0) {
          if (e.deltaY < 0) {
            isPulling = true;
            overscrollAmount = Math.min(overscrollAmount + Math.abs(e.deltaY), 300);
            e.preventDefault();
          } else {
            isPulling = false;
          }
        } else {
          isPulling = false;
        }
      }

      window.addEventListener('scroll', onScroll, { passive: true });
      window.addEventListener('touchstart', onTouchStart, { passive: true });
      window.addEventListener('touchmove', onTouchMove, { passive: false });
      window.addEventListener('touchend', onTouchEnd, { passive: true });
      window.addEventListener('wheel', onWheel, { passive: false });
      
      // Initial setup
      const initialValues = calculateParallaxValues();
      targetOffset = initialValues.offset;
      currentOffset = targetOffset;
      targetScale = initialValues.scale;
      currentScale = targetScale;
      lastTime = performance.now();
      animate();
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initParallax);
    } else {
      initParallax();
    }
  </script>
</MainLayout>